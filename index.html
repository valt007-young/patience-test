<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CONTROL TEST</title>
<style>
html,body{
  margin:0;height:100%;
  font-family:system-ui,sans-serif;
  background:#f2f2f2;
  color:#222;
}
#app{
  height:100%;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  text-align:center;
}
h1{letter-spacing:3px;font-weight:500;}
#status{margin:20px;height:40px;}
#bar{
  width:260px;height:10px;
  background:#ddd;
  border-radius:10px;
  overflow:hidden;
}
#fill{
  width:0%;height:100%;
  background:#222;
  transition:width .3s;
}
#btn{
  margin-top:30px;
  padding:14px 50px;
  border-radius:30px;
  border:2px solid #222;
  background:#fff;
  font-size:1rem;
}
#btn:active{background:#222;color:#fff}
.shake{animation:shake .3s}
@keyframes shake{
  0%{transform:translateX(0)}
  25%{transform:translateX(-4px)}
  50%{transform:translateX(4px)}
  75%{transform:translateX(-4px)}
  100%{transform:translateX(0)}
}
.hidden{display:none}
</style>
</head>
<body>

<div id="app">
  <h1>CONTROL TEST</h1>
  <div id="status">Initializingâ€¦</div>
  <div id="bar"><div id="fill"></div></div>
  <button id="btn">Tap</button>
</div>

<script>
const status=document.getElementById("status");
const fill=document.getElementById("fill");
const btn=document.getElementById("btn");

let start=Date.now();
let alive=true;
let progress=0;
let touchSafe=true;
let inactivityKills=false;
let lastAction=Date.now();

const switchTouch=8000+Math.random()*6000;
const switchInactivity=16000+Math.random()*8000;

function fail(msg){
  if(!alive)return;
  alive=false;
  document.body.classList.add("shake");
  setTimeout(()=>{
    status.innerText="Failed.\nTime: "+((Date.now()-start)/1000).toFixed(2)+"s";
    btn.innerText="Retry";
  },500);
}

setInterval(()=>{
  if(!alive)return;

  const now=Date.now();
  progress=Math.min(100,progress+0.3+Math.random()*0.2);
  fill.style.width=progress+"%";

  if(now-start>switchTouch) touchSafe=false;
  if(now-start>switchInactivity) inactivityKills=true;

  if(inactivityKills && now-lastAction>5000 && Math.random()>0.6){
    setTimeout(()=>fail("Inaction"),1200+Math.random()*2000);
  }

  if(progress>85 && Math.random()>0.7){
    status.innerText="Confirm to proceed";
  } else {
    const msgs=[
      "Hold.",
      "Maintain control.",
      "Do not rush.",
      "Observe.",
      "Stability fluctuating."
    ];
    status.innerText=msgs[Math.floor(Math.random()*msgs.length)];
  }

},700);

btn.onclick=()=>{
  if(!alive){location.reload();return;}
  lastAction=Date.now();

  if(!touchSafe && Math.random()>0.3){
    setTimeout(()=>fail("Impulse"),800+Math.random()*2000);
  }

  if(progress>90 && Math.random()>0.5){
    setTimeout(()=>fail("Confirmation error"),1000);
  }
};
</script>

</body>
</html>
